import numpy as np
import random


def generate_geometric_distribution(p):
    """ Probability that we would have `i` failed trials before first success is `p * (1 - p)^i`, i >= 0"""

    x = random.random()

    # Inverse transform sampling: find minimal i such that F(i) >= x
    i = 0
    while x > 0:
        x -= p * (1 - p) ** i
        i += 1

    return i - 1


def conditional_probability(generator, awaiting_event_checker, condition_event_checker, n):
    """ Probability of awaiting event given condition event. Does n samples """

    both_count = 0
    condition_event_count = 0

    for _ in range(n):
        outcome = generator()
        if condition_event_checker(outcome):
            condition_event_count += 1
            if awaiting_event_checker(outcome):
                both_count += 1

    return both_count / condition_event_count


def solve(p, i, j):
    """ P(X = i | X + Y = j) where X, Y are independent random variables with geometric distribution """

    def generator():
        return generate_geometric_distribution(p), generate_geometric_distribution(p)

    def awaiting_event_checker(outcome):
        return outcome[0] == i

    def condition_event_checker(outcome):
        return outcome[0] + outcome[1] == j

    return conditional_probability(generator, awaiting_event_checker, condition_event_checker, 1000000)


if __name__ == '__main__':
    # ≈1/3, because, according to the theoretic Appendix (see github),
    # P(X = 1 | X + Y = 2) = 1 / (2 + 1) = 1/3
    # print(solve(0.5, 1, 2))

    for p in np.linspace(0.1, 0.9, 9):
        for i in range(0, 10, 3):
            for j in range(1, 10, 3):
                print(f'p = {p}, i = {i}, j = {j}, P(X = {i} | X + Y = {j}) = {solve(p, i, j)} ≈ {1 / (j + 1) if i <= j else 0}')

"""
p = 0.1, i = 0, j = 1, P(X = 0 | X + Y = 1) = 0.5015407025603675 ≈ 0.5
p = 0.1, i = 0, j = 4, P(X = 0 | X + Y = 4) = 0.1968566294051354 ≈ 0.2
p = 0.1, i = 0, j = 7, P(X = 0 | X + Y = 7) = 0.12586677873502836 ≈ 0.125
p = 0.1, i = 3, j = 1, P(X = 3 | X + Y = 1) = 0.0 ≈ 0
p = 0.1, i = 3, j = 4, P(X = 3 | X + Y = 4) = 0.20062836624775585 ≈ 0.2
p = 0.1, i = 3, j = 7, P(X = 3 | X + Y = 7) = 0.12395535946016091 ≈ 0.125
p = 0.1, i = 6, j = 1, P(X = 6 | X + Y = 1) = 0.0 ≈ 0
p = 0.1, i = 6, j = 4, P(X = 6 | X + Y = 4) = 0.0 ≈ 0
p = 0.1, i = 6, j = 7, P(X = 6 | X + Y = 7) = 0.12589398401346236 ≈ 0.125
p = 0.1, i = 9, j = 1, P(X = 9 | X + Y = 1) = 0.0 ≈ 0
p = 0.1, i = 9, j = 4, P(X = 9 | X + Y = 4) = 0.0 ≈ 0
p = 0.1, i = 9, j = 7, P(X = 9 | X + Y = 7) = 0.0 ≈ 0
p = 0.2, i = 0, j = 1, P(X = 0 | X + Y = 1) = 0.4985240655004195 ≈ 0.5
p = 0.2, i = 0, j = 4, P(X = 0 | X + Y = 4) = 0.19898108424336974 ≈ 0.2
p = 0.2, i = 0, j = 7, P(X = 0 | X + Y = 7) = 0.1242992604961832 ≈ 0.125
p = 0.2, i = 3, j = 1, P(X = 3 | X + Y = 1) = 0.0 ≈ 0
p = 0.2, i = 3, j = 4, P(X = 3 | X + Y = 4) = 0.1983004908065343 ≈ 0.2
p = 0.2, i = 3, j = 7, P(X = 3 | X + Y = 7) = 0.12362255349052795 ≈ 0.125
p = 0.2, i = 6, j = 1, P(X = 6 | X + Y = 1) = 0.0 ≈ 0
p = 0.2, i = 6, j = 4, P(X = 6 | X + Y = 4) = 0.0 ≈ 0
p = 0.2, i = 6, j = 7, P(X = 6 | X + Y = 7) = 0.12479646255657967 ≈ 0.125
p = 0.2, i = 9, j = 1, P(X = 9 | X + Y = 1) = 0.0 ≈ 0
p = 0.2, i = 9, j = 4, P(X = 9 | X + Y = 4) = 0.0 ≈ 0
p = 0.2, i = 9, j = 7, P(X = 9 | X + Y = 7) = 0.0 ≈ 0
p = 0.30000000000000004, i = 0, j = 1, P(X = 0 | X + Y = 1) = 0.4986921784344187 ≈ 0.5
p = 0.30000000000000004, i = 0, j = 4, P(X = 0 | X + Y = 4) = 0.19958650225208596 ≈ 0.2
p = 0.30000000000000004, i = 0, j = 7, P(X = 0 | X + Y = 7) = 0.1215353617446369 ≈ 0.125
p = 0.30000000000000004, i = 3, j = 1, P(X = 3 | X + Y = 1) = 0.0 ≈ 0
p = 0.30000000000000004, i = 3, j = 4, P(X = 3 | X + Y = 4) = 0.19990205409201373 ≈ 0.2
p = 0.30000000000000004, i = 3, j = 7, P(X = 3 | X + Y = 7) = 0.12614352510672902 ≈ 0.125
p = 0.30000000000000004, i = 6, j = 1, P(X = 6 | X + Y = 1) = 0.0 ≈ 0
p = 0.30000000000000004, i = 6, j = 4, P(X = 6 | X + Y = 4) = 0.0 ≈ 0
p = 0.30000000000000004, i = 6, j = 7, P(X = 6 | X + Y = 7) = 0.1250168668195925 ≈ 0.125
p = 0.30000000000000004, i = 9, j = 1, P(X = 9 | X + Y = 1) = 0.0 ≈ 0
p = 0.30000000000000004, i = 9, j = 4, P(X = 9 | X + Y = 4) = 0.0 ≈ 0
p = 0.30000000000000004, i = 9, j = 7, P(X = 9 | X + Y = 7) = 0.0 ≈ 0
p = 0.4, i = 0, j = 1, P(X = 0 | X + Y = 1) = 0.5013726603564228 ≈ 0.5
p = 0.4, i = 0, j = 4, P(X = 0 | X + Y = 4) = 0.2014040020800031 ≈ 0.2
p = 0.4, i = 0, j = 7, P(X = 0 | X + Y = 7) = 0.12478803547104773 ≈ 0.125
p = 0.4, i = 3, j = 1, P(X = 3 | X + Y = 1) = 0.0 ≈ 0
p = 0.4, i = 3, j = 4, P(X = 3 | X + Y = 4) = 0.1997920437478338 ≈ 0.2
p = 0.4, i = 3, j = 7, P(X = 3 | X + Y = 7) = 0.12316879203058291 ≈ 0.125
p = 0.4, i = 6, j = 1, P(X = 6 | X + Y = 1) = 0.0 ≈ 0
p = 0.4, i = 6, j = 4, P(X = 6 | X + Y = 4) = 0.0 ≈ 0
p = 0.4, i = 6, j = 7, P(X = 6 | X + Y = 7) = 0.12684989429175475 ≈ 0.125
p = 0.4, i = 9, j = 1, P(X = 9 | X + Y = 1) = 0.0 ≈ 0
p = 0.4, i = 9, j = 4, P(X = 9 | X + Y = 4) = 0.0 ≈ 0
p = 0.4, i = 9, j = 7, P(X = 9 | X + Y = 7) = 0.0 ≈ 0
p = 0.5, i = 0, j = 1, P(X = 0 | X + Y = 1) = 0.5003662299924353 ≈ 0.5
p = 0.5, i = 0, j = 4, P(X = 0 | X + Y = 4) = 0.20017961383026492 ≈ 0.2
p = 0.5, i = 0, j = 7, P(X = 0 | X + Y = 7) = 0.11859787018255578 ≈ 0.125
p = 0.5, i = 3, j = 1, P(X = 3 | X + Y = 1) = 0.0 ≈ 0
p = 0.5, i = 3, j = 4, P(X = 3 | X + Y = 4) = 0.20056866210712365 ≈ 0.2
p = 0.5, i = 3, j = 7, P(X = 3 | X + Y = 7) = 0.12599074250206074 ≈ 0.125
p = 0.5, i = 6, j = 1, P(X = 6 | X + Y = 1) = 0.0 ≈ 0
p = 0.5, i = 6, j = 4, P(X = 6 | X + Y = 4) = 0.0 ≈ 0
p = 0.5, i = 6, j = 7, P(X = 6 | X + Y = 7) = 0.12266580811332904 ≈ 0.125
p = 0.5, i = 9, j = 1, P(X = 9 | X + Y = 1) = 0.0 ≈ 0
p = 0.5, i = 9, j = 4, P(X = 9 | X + Y = 4) = 0.0 ≈ 0
p = 0.5, i = 9, j = 7, P(X = 9 | X + Y = 7) = 0.0 ≈ 0
p = 0.6, i = 0, j = 1, P(X = 0 | X + Y = 1) = 0.500678557916914 ≈ 0.5
p = 0.6, i = 0, j = 4, P(X = 0 | X + Y = 4) = 0.19859823255408993 ≈ 0.2
p = 0.6, i = 0, j = 7, P(X = 0 | X + Y = 7) = 0.12796610169491526 ≈ 0.125
p = 0.6, i = 3, j = 1, P(X = 3 | X + Y = 1) = 0.0 ≈ 0
p = 0.6, i = 3, j = 4, P(X = 3 | X + Y = 4) = 0.20029895366218237 ≈ 0.2
p = 0.6, i = 3, j = 7, P(X = 3 | X + Y = 7) = 0.12080393414581997 ≈ 0.125
p = 0.6, i = 6, j = 1, P(X = 6 | X + Y = 1) = 0.0 ≈ 0
p = 0.6, i = 6, j = 4, P(X = 6 | X + Y = 4) = 0.0 ≈ 0
p = 0.6, i = 6, j = 7, P(X = 6 | X + Y = 7) = 0.12383375742154368 ≈ 0.125
p = 0.6, i = 9, j = 1, P(X = 9 | X + Y = 1) = 0.0 ≈ 0
p = 0.6, i = 9, j = 4, P(X = 9 | X + Y = 4) = 0.0 ≈ 0
p = 0.6, i = 9, j = 7, P(X = 9 | X + Y = 7) = 0.0 ≈ 0
p = 0.7000000000000001, i = 0, j = 1, P(X = 0 | X + Y = 1) = 0.5010798547476137 ≈ 0.5
p = 0.7000000000000001, i = 0, j = 4, P(X = 0 | X + Y = 4) = 0.20284283474126158 ≈ 0.2
p = 0.7000000000000001, i = 0, j = 7, P(X = 0 | X + Y = 7) = 0.12689804772234273 ≈ 0.125
p = 0.7000000000000001, i = 3, j = 1, P(X = 3 | X + Y = 1) = 0.0 ≈ 0
p = 0.7000000000000001, i = 3, j = 4, P(X = 3 | X + Y = 4) = 0.19533498258191548 ≈ 0.2
p = 0.7000000000000001, i = 3, j = 7, P(X = 3 | X + Y = 7) = 0.12256586483390607 ≈ 0.125
p = 0.7000000000000001, i = 6, j = 1, P(X = 6 | X + Y = 1) = 0.0 ≈ 0
p = 0.7000000000000001, i = 6, j = 4, P(X = 6 | X + Y = 4) = 0.0 ≈ 0
p = 0.7000000000000001, i = 6, j = 7, P(X = 6 | X + Y = 7) = 0.12653562653562653 ≈ 0.125
p = 0.7000000000000001, i = 9, j = 1, P(X = 9 | X + Y = 1) = 0.0 ≈ 0
p = 0.7000000000000001, i = 9, j = 4, P(X = 9 | X + Y = 4) = 0.0 ≈ 0
p = 0.7000000000000001, i = 9, j = 7, P(X = 9 | X + Y = 7) = 0.0 ≈ 0
p = 0.8, i = 0, j = 1, P(X = 0 | X + Y = 1) = 0.4993205778992581 ≈ 0.5
p = 0.8, i = 0, j = 4, P(X = 0 | X + Y = 4) = 0.1907650166307963 ≈ 0.2
p = 0.8, i = 0, j = 7, P(X = 0 | X + Y = 7) = 0.11475409836065574 ≈ 0.125
p = 0.8, i = 3, j = 1, P(X = 3 | X + Y = 1) = 0.0 ≈ 0
p = 0.8, i = 3, j = 4, P(X = 3 | X + Y = 4) = 0.19693819693819695 ≈ 0.2
p = 0.8, i = 3, j = 7, P(X = 3 | X + Y = 7) = 0.045454545454545456 ≈ 0.125
p = 0.8, i = 6, j = 1, P(X = 6 | X + Y = 1) = 0.0 ≈ 0
p = 0.8, i = 6, j = 4, P(X = 6 | X + Y = 4) = 0.0 ≈ 0
p = 0.8, i = 6, j = 7, P(X = 6 | X + Y = 7) = 0.09090909090909091 ≈ 0.125
p = 0.8, i = 9, j = 1, P(X = 9 | X + Y = 1) = 0.0 ≈ 0
p = 0.8, i = 9, j = 4, P(X = 9 | X + Y = 4) = 0.0 ≈ 0
p = 0.8, i = 9, j = 7, P(X = 9 | X + Y = 7) = 0.0 ≈ 0
p = 0.9, i = 0, j = 1, P(X = 0 | X + Y = 1) = 0.5005163320752861 ≈ 0.5
p = 0.9, i = 0, j = 4, P(X = 0 | X + Y = 4) = 0.24053452115812918 ≈ 0.2
"""